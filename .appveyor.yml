image: Visual Studio 2017

environment:
  DEPLOY_DIR: Spectral-%APPVEYOR_BUILD_VERSION%
  matrix:
  - QTDIR: C:\Qt\5.12.1\mingw73_64
    VCVARS: "C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Community\\VC\\Auxiliary\\Build\\vcvars64.bat"
    PLATFORM:

init:
  - call "%QTDIR%\bin\qtenv2.bat"
  - set PATH=%PATH%;C:\Qt\Tools\QtCreator\bin;%QT_DIR%\bin;C:\MinGW\bin
  - call "%VCVARS%" %platform%
  - cd /D "%APPVEYOR_BUILD_FOLDER%"

before_build:
  - git submodule update --init --recursive

build_script:
  - qmake spectral.pro CONFIG+=release CONFIG+=qtquickcompiler PREFIX="%DEPLOY_DIR%"
  - mingw32-make

after_build:
  - mingw32-make install
  - windeployqt --release --qmldir qml --qmldir imports "%DEPLOY_DIR%\spectral.exe"
  - 7z a spectral.zip "%DEPLOY_DIR%\"

artifacts:
  - path: spectral.zip
    name: portable
