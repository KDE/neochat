stages:
  - build
  - deploy
  
build-qt-5.7:
  image: rabits/qt:5.7-desktop
  stage: build
  before_script:
    - git submodule update --init --recursive
  script:
    - mkdir -p build && cd build
    - qmake ../matrique.pro -spec linux-g++ CONFIG+=qtquickcompiler
    - make
  artifacts:
    paths:
    - build/matrique
    
build-qt-5.9:
  image: rabits/qt:5.9-desktop
  stage: build
  before_script:
    - git submodule update --init --recursive
  script:
    - mkdir -p build && cd build
    - qmake ../matrique.pro -spec linux-g++ CONFIG+=qtquickcompiler
    - make
  artifacts:
    paths:
    - build/matrique
    
build-qt-5.10:
  image: rabits/qt:5.10-desktop
  stage: build
  before_script:
    - git submodule update --init --recursive
  script:
    - mkdir -p build && cd build
    - qmake ../matrique.pro -spec linux-g++ CONFIG+=qtquickcompiler
    - make
  artifacts:
    paths:
    - build/matrique
    
build-qt-5.11:
  image: rabits/qt:5.11-desktop
  stage: build
  before_script:
    - git submodule update --init --recursive
  script:
    - mkdir -p build && cd build
    - qmake ../matrique.pro -spec linux-g++ CONFIG+=qtquickcompiler
    - make
  artifacts:
    paths:
    - build/matrique

build-flatpak:
  image: registry.gitlab.com/b0/matrique/flatpak
  stage: build
  before_script:
    - git submodule update --init --recursive
  script:
    - cd flatpak
    - flatpak-builder --force-clean --repo=repo build-dir org.eu.encom.matrique.yaml
    - flatpak build-bundle repo matrique.flatpak org.eu.encom.matrique
    - cd ../
  artifacts:
    paths:
    - flatpak/matrique.flatpak
